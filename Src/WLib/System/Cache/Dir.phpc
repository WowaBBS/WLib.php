<?  // Taken from builder of UE, directory Builder/Lib/Cache   $Loader->Parent_Class('/Object');  $Loader->Load_Lib('/FS/My');  $Loader->Load_Lib('/Cache/Utils');   Class C_Cache_Dir extends C_Object  {    Var $DirPath ='Cache';    Var $Checked =[];    Var $Check_Enabled =true;    Var $RemoveUnChecked =true;        Function _Init(Array $Args)    {      parent::_Init($Args);    }        Function _Done()    {      if($this->RemoveUnChecked)        $this->RemoveDirty();      parent::_Done();    }     Function Load()    {    }        Function Save()    {    }        Function Check($Key)    {      if($Key[0]==='/')        $Key=SubStr($Key, 1);      $this->Checked[$Key]=true;    }        Function Get($Key, $Hash, $Getter)    {      return Cache_FileLoad($this->GetFilePath($Key), $Hash, $Getter);    }     Function GetFilePath($Key)    {      if($Key[0]==='/')        return $this->DirPath.$Key;      else        return $this->DirPath.'/'.$Key;    }        Function RemoveDirty()    {      $Path    =$this->DirPath;      $Checked =$this->Checked;      $PathLen =StrLen($Path);            $Stack   =[$Path];      While(IsSet($Stack[0]))      {        $Dir=Array_Pop($Stack);        If(!($Handle=FS_OpenDir($Dir)))          Continue;              $Empty=true;        while(False !== ($Name=FS_ReadDir($Handle)))        {          if($Name==='.'  ) continue;          if($Name==='..' ) continue;                    $DirName=$Dir.'/'.$Name;                    if(FS_Is_Dir($DirName))          {            Array_Push($Stack, $DirName);            $Empty=false;          }          if(FS_Is_File($DirName))          {            $Key=SubStr($DirName, $PathLen+1);            if(IsSet($Checked[$Key]))              $Empty=false;            else            {              echo 'RemoveCache ', $Key, "\n";              FS_UnLink($DirName);            }          }        }        FS_CloseDir($Handle);        if($Empty)          FS_RmDir($Dir);      }    }  }?>